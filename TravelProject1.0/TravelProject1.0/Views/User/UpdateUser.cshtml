@section Styles
    {
    <link href="~/css/table.min.css" rel="stylesheet" />
}

<div id="app">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <table class="border=1">
                    <thead style="font-size: 24px;">會員資料</thead>

                    <tr>
                        <th>使用者名稱</th>
                        <td>{{user.name}}</td>
                    </tr>
                    <tr>
                        <th>郵件</th>
                        <td>{{user.email}}</td>
                    </tr>
                    <tr>
                        <th>電話</th>
                        <td>{{user.phone}}</td>
                    </tr>
                    <tr>
                        <th>性別</th>
                        <td>{{user.gender}}</td>
                    </tr>
                    <tr>
                        <th>生日</th>
                        <td>{{user.birthday | formatDate}}</td>
                    </tr>
                    <tr colspan="2">
                        <td colspan="2">
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" @@click="putUser(user)">更改資料</button>
                        </td>
                    </tr>

                </table>
            </div>
            <div class="col-md-3">
                <div class="blog_right_sidebar">
                    <aside class="single_sidebar_widget post_category_widget">
                        <div style="text-align:center">
                            <img class="" src="~/img/dog.jpg" style="border-radius:50%;width:150px;height:100px" />
                        </div>
                        <br />
                        <h4 class="widget_title">會員資料</h4>
                        <ul class="list_style cat-list">
                            <li>
                                <a class="d-flex justify-content-between" asp-Controller="User" asp-action="UpdateUser" >
                                    <p>個人資訊</p>
                                </a>
                            </li>
                            <li>
                                <a class="d-flex justify-content-between" asp-Controller="User" asp-action="UserOrderDetails">
                                    <p>商品訂單</p>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="d-flex justify-content-between" >
                                    <p>收藏夾</p>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="d-flex justify-content-between" >
                                    <p>通知與消息</p>
                                </a>
                            </li>
                        </ul>
                    </aside>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">修改會員資料</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table>
                        <tr>
                            <th>使用者名稱</th>
                            <td><input v-model="userPut.name" /></td>
                        </tr>
                        <tr>
                            <th>郵件</th>
                            <td><input v-model="userPut.email" /></td>
                        </tr>
                        <tr>
                            <th>電話</th>
                            <td><input v-model="userPut.phone" /></td>
                        </tr>
                        <tr>
                            <th>性別</th>
                            <td><input v-model="userPut.gender " /></td>
                        </tr>
                        <tr>
                            <th>生日</th>
                            <td><input v-model="userPut.birthday" /></td>
                        </tr>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" @@click="UpdateUser">修改會員資料</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>

</div>
@section Scripts{
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js" integrity="sha512-uMtXmF28A2Ab/JJO2t/vYhlaa/3ahUOgj1Zf27M5rOo8/+fcTUVH0/E0ll68njmjrLqOBjXM3V9NiPFL5ywWPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="~/js/validation.min.js"></script>
    <script>
        var baseAddress = "https://localhost:7025";
        var vueApp = new Vue({
            el: '#app',
            data: {
                user: {},
                userUpdate: {},
                userPut: {}
            },
            computed: {

            },
            filters: {
                //日期格式
                formatDate: function (str) {
                    if (!str) return "";
                    var d = new Date(str);
                    return `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;
                },
            },
            mounted: function () {
                let _this = this;
                fetch(`${baseAddress}/api/UserApi/GetUser/69`, {
                    method: "GET"
                }).then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                }).then(data => {
                    _this.user = data
                }).catch(err => {
                    alert(err);
                });
            },
            methods: {
                putUser: function (model) {
                    let _this = this;
                    _this.userPut = Object.assign({}, model);
                },

                UpdateUser: function () {
                    let _this = this;
                    let request = {
                        userId: 69,
                        name: _this.userPut.name,
                        email: _this.userPut.email,
                        phone: _this.userPut.phone,
                        gender: _this.userPut.gender,
                        birthday: _this.userPut.birthday,
                    };

                    fetch(`${baseAddress}/api/UserApi/UpdateUser/69`, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(request)
                    })
                        .then(response => {
                            if (response.ok) {
                                alert("修改成功");
                            }
                        })
                        .catch(err => {
                            console.log(err);
                        });
                }
            },
        });

    </script>
}